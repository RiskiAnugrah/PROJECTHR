
@{
    ViewBag.Title = "LIST USER";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.pathParent = Url.Content("~").Substring(0, Url.Content("~").Length - 1);
}
<style>
    .customClass {
        color: red;
        animation: blink 1s linear infinite;
    }

    .customClassGreen {
        color: green;
        animation: blink 1s linear infinite;
    }

    .fontpage {
        font-size: 14px;
    }
</style>

<input type="hidden" id="urlPath" name="urlPath" value="@ViewBag.pathParent" />


<div id="dv_grid"></div>
<script>
        $(document).ready(function () {
            fn_load_grid();
        });


        function onModalClose() {

        }


        function tambahUpah() {
            var win = $("#dv_add").data("kendoWindow");
            win.title("INPUT USER");
            win.refresh({ url: $("#urlPath").val() + '/PAYROLL/frm_inputUpah' });

            win.center().open();
        }

      



        function fn_load_grid() {
            if ($("#dv_grid").data().kendoGrid != null) {
                $("#dv_grid").data().kendoGrid.destroy();
                $("#dv_grid").empty();
            }

            $("#dv_grid").kendoGrid({
                dataSource: {
                    type: "json",
                    transport: {
                        read: {
                            url: $("#urlPath").val() + "/ACCOUNT/listuser",
                            contentType: "application/json",
                            type: "POST"
                        },
                        create: {
                            url: $("#urlPath").val() + "/ACCOUNT/insertUser",
                            contentType: "application/json",
                            type: "POST",
                            complete: function (data) {
                                if (data.status) {
                                    alert(data.responseJSON.remarks);
                                    $("#grid_vendor").data("kendoGrid").dataSource.read();
                                } else {
                                    alert(data.responseJSON.remarks);
                                }
                            }
                        },
                        update: {
                            url: $("#urlPath").val() + "/ACCOUNT/edituser",
                            contentType: "application/json",
                            type: "POST",
                            complete: function (data) {
                                if (data.status) {
                                    alert("Data berhasil dirubah");
                                    $("#dv_grid").data("kendoGrid").dataSource.read();
                                } else {
                                    alert(data.responseJSON.remarks);
                                }
                            }
                        },
                        parameterMap: function (data, operation) {
                            if (operation == "update") {
                                data.akses = $("#ddl_akses").val();
                               
                            }
                            return kendo.stringify(data);
                        }
                    },
                    error: function (e) {
                        if (e.errors) {
                            alert(e.errors);
                            this.cancelChanges();
                        }
                    },
                    schema: {
                        data: "Data",
                        total: "Total",
                        model: {
                            id: "id",
                            fields: {
                                id: { type: "number", editable: false },
                                BADGENUMBER: { type: "string", editable: false },
                                NAME: { type: "string", editable: false },
                                username: { type: "string", validation: { required: true } },
                                password: { type: "string", editable: true },
                                akses: { type: "string", editable: true },

                            

                            }
                        }

                    },
                    pageSize: 100,
                    serverPaging: true,
                    serverFiltering: true,
                    serverSorting: false,


                },
                height: 600,
                filterable: true,
                sortable: true,
                toolbar: ["create"],
                editable: "inline",
                selectable: "multiple",
                pageable: {
                    refresh: true,
                    buttonCount: 10,
                    input: true,
                    pageSizes: [50, 100, 200, 300, 500, 1000, 100000],
                    info: true,
                    messages: {
                    }
                },
                // toolbar: [{ text: "View", click: addIssue }],
                columns: [



                  //{
                  //   // field: "PENUMPANG_DESC",
                  //    //title: "<center>TIPE PENUMPANG</center>",
                  //    width: 10,
                  //    template: '<div style="text-align:center;"><input type="checkbox"  class="chkbx" /></div>',
                  //    headerTemplate: '<div style="text-align:center;"><input type="checkbox" id="SelectAll" /></div>'
                  //},
                  //{ command: [{ text: "RESCHEDULE", click: cufn_reschedule }, { text: " BATALKAN ", click: cufn_batalkan }], width: 30 },
                  {
                      field: "BADGENUMBER",
                      title: "<center>NIK</center>",
                      width: 20

                  },
                  {
                      field: "NAME",
                      title: "<center>NAMA</center>",
                      width: 55

                  },
                  {
                      field: "username",
                      title: "<center>USERNAME</center>",
                      width: 50,

                  },

                  {
                      field: "password",
                      title: "<center>PASSWORD</center>",
                      width: 40,
                      template:templatepassword

                  },

                  {
                      field: "akses",
                      title: "<center>AKSES</center>",
                      width: 40,
                      editor:editor_akses

                  },  { command: ["edit"], title: "ACTION", width: "80px" },


                ],
                   
                });
      }

        function dateTimeNow() {
            now = new Date();
            year = "" + now.getFullYear();
            month = "" + (now.getMonth() + 1); if (month.length == 1) { month = "0" + month; }
            day = "" + now.getDate(); if (day.length == 1) { day = "0" + day; }
            hour = "" + now.getHours(); if (hour.length == 1) { hour = "0" + hour; }
            minute = "" + now.getMinutes(); if (minute.length == 1) { minute = "0" + minute; }
            second = "" + now.getSeconds(); if (second.length == 1) { second = "0" + second; }
            return year + "-" + month + "-" + day + " " + hour + ":" + minute + ":" + second;
        }
        function templateFunction(item) {

            if (dateTimeNow()>item.active_date_end  ) {
                return "<span class='customClass'><B>" + "EXPIRED" + "</B></span>";
            }
            else {
                return "<span class='customClassGreen'><B>" + "ACTIVE" + "</B></span>";
            }

            return item.Estimasi;
        }

        function templatepassword(item) {
            return '********';

        }

        function editor_akses(container, options) {
            $('<input id="ddl_akses" data-text-field="text" data-value-field="value" data-bind="value:akses"/>')
            .appendTo(container)
            .kendoDropDownList({
                dataSource: [
                { text: "ADMIN", value: "ADMIN" },
                { text: "HRD", value: "HRD" },
                { text: "PRODUKSI", value: "PRODUKSI" },
                

                ],
                dataTextField: "text",
                dataValueField: "value"
            }).data("kendoDropDownList");
        }
     
</script>
